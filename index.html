<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Our Wedding</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Georgia', serif;
      background: #000;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
      padding-top: calc(58vh - 50px);
      position: relative;
      overflow: hidden;
    }
    
    /* Better mobile viewport handling */
    @media (max-width: 600px) {
      body {
        /* Keep original positioning by default - only adjust via JS when keyboard opens */
        min-height: 100dvh; /* Use dynamic viewport height on mobile */
        overflow-y: auto; /* Allow scrolling when keyboard appears */
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        /* Prevent automatic scrolling when input is focused */
        scroll-behavior: auto;
      }
      
      /* Ensure container doesn't prevent scrolling */
      .container {
        position: relative;
      }
      
      /* Prevent scrolling on input focus */
      .password-input:focus {
        scroll-margin: 0;
      }
    }
    
    /* Video background for password page */
    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: -1;
      overflow: hidden;
      opacity: 1;
      transition: opacity 3s ease-out;
    }
    
    .video-background video {
      width: 100%;
      height: 100vh;
      object-fit: cover;
      object-position: center;
    }
    
    /* Dark overlay for better text readability */
    .video-background::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      pointer-events: none;
    }
    
    /* Fallback gradient if video doesn't load */
    body.no-video {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    /* Fade out video on main content page */
    body.content-visible .video-background {
      opacity: 0;
      transition: opacity 3s ease-out;
      pointer-events: none;
    }
    
    body.content-visible {
      background: #2c2c2c;
      align-items: center;
      padding-top: 0;
      padding: 0;
    }
    
    .container {
      background: transparent;
      border-radius: 0;
      max-width: 100%;
      width: 100%;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }
    
    /* No background or box for main content */
    .container.content-showing {
      background: transparent;
      box-shadow: none;
      height: 100vh;
      max-width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .password-page {
      padding: 60px 40px;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    
    .password-page h1 {
      color: #fff;
      margin-bottom: 20px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .password-page p {
      color: #fff;
      margin-bottom: 30px;
      font-size: 1.1em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    .password-input {
      width: 100%;
      max-width: 300px;
      padding: 15px 20px;
      font-size: 16px;
      border: 2px solid rgba(68, 68, 68, 0.6);
      border-radius: 10px;
      transition: border-color 0.3s, color 0.3s;
      margin: 0;
      height: 50px;
      background: transparent;
      color: #fff;
      text-align: center;
    }
    
    .password-input::placeholder {
      color: rgba(200, 200, 200, 0.9);
      font-style: italic;
      text-align: center;
    }
    
    .password-input:focus {
      outline: none;
      border-color: rgba(68, 68, 68, 0.8);
    }
    
    .password-input-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      position: relative;
    }
    
    /* Ensure input stays visible on mobile when keyboard opens */
    @media (max-width: 600px) {
      .password-page {
        padding: 20px 20px;
        min-height: auto;
      }
      
      .password-input-container {
        margin-top: 10px;
      }
      
      /* When input is focused, ensure it's visible */
      .password-input:focus {
        position: relative;
        z-index: 10;
      }
    }
    
    .password-input.granted {
      color: #4ade80;
      border-color: #4ade80;
    }
    
    .btn {
      background: rgba(68, 68, 68, 0.7);
      color: white;
      border: none;
      padding: 0;
      font-size: 24px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
      font-weight: bold;
      width: 50px;
      height: 50px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      line-height: 1;
      backdrop-filter: blur(10px);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(68, 68, 68, 0.4);
      background: rgba(68, 68, 68, 0.85);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .error-message {
      color: #ff6b6b;
      margin-top: 15px;
      font-size: 14px;
      min-height: 20px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      font-weight: 500;
    }
    
    .main-content {
      padding: 0;
      display: none;
      text-align: center;
      width: 100%;
      background: transparent;
      opacity: 0;
      align-items: center;
      justify-content: center;
      height: 100vh;
      transition: opacity 5s ease-in;
    }
    
    .main-content h1 {
      font-size: 3.5em;
      color: #f5f5f5;
      font-weight: 300;
      letter-spacing: 2px;
      line-height: 1.6;
    }
    
    @media (max-width: 600px) {
      .main-content h1 {
        font-size: 2em;
      }
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 30px;
      border-bottom: 2px solid #eee;
    }
    
    .header h1 {
      color: #333;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    
    .header .date {
      color: #667eea;
      font-size: 1.3em;
      font-style: italic;
    }
    
    .section {
      margin-bottom: 40px;
    }
    
    .section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.8em;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
    }
    
    .section p, .section li {
      color: #555;
      line-height: 1.8;
      font-size: 1.05em;
    }
    
    .venue-info {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    
    .schedule-item {
      background: #f9f9f9;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .schedule-item .time {
      font-weight: bold;
      color: #667eea;
      min-width: 100px;
    }
    
    .schedule-item .event {
      flex: 1;
      font-weight: bold;
      color: #333;
    }
    
    .schedule-item .location {
      color: #888;
      font-style: italic;
    }
    
    .accommodation-item, .registry-item {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    
    .accommodation-item h3, .registry-item h3 {
      color: #333;
      margin-bottom: 10px;
    }
    
    .accommodation-item a, .registry-item a {
      color: #667eea;
      text-decoration: none;
      font-weight: bold;
    }
    
    .accommodation-item a:hover, .registry-item a:hover {
      text-decoration: underline;
    }
    
    .code {
      background: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-family: monospace;
      color: #e74c3c;
      font-weight: bold;
    }
    
    @media (max-width: 600px) {
      .password-page, .main-content {
        padding: 40px 20px;
      }
      
      .header h1 {
        font-size: 2em;
      }
      
      .schedule-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .schedule-item .time {
        margin-bottom: 5px;
      }
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Video Background (only visible on password page) -->
  <div class="video-background">
    <video autoplay muted loop playsinline preload="auto">
      <source src="disco-ball.mp4" type="video/mp4">
    </video>
  </div>
  
  <!-- Password Page -->
  <div class="container">
    <div id="passwordPage" class="password-page">
      <div class="password-input-container">
        <input 
          type="password" 
          id="passwordInput" 
          class="password-input"
          placeholder="Enter password v0"
          oninput="checkPasswordAsYouType()"
          onkeydown="if(event.key === 'Enter') { event.preventDefault(); event.stopPropagation(); return false; }"
          onfocus="handleInputFocus()"
        />
      </div>
      <div id="errorMessage" class="error-message"></div>
    </div>
    
    <!-- Main Content (hidden until password correct) -->
    <div id="mainContent" class="main-content">
      <!-- Content will be dynamically loaded here after decryption -->
    </div>
  </div>

  <script>
    // Lock video background height to prevent resizing when keyboard opens
    (function() {
      function lockVideoHeight() {
        const videoBackground = document.querySelector('.video-background');
        if (!videoBackground) return;
        
        const videoElement = videoBackground.querySelector('video');
        const initialHeight = window.innerHeight;
        
        // Lock both the container and video element to initial height
        videoBackground.style.height = initialHeight + 'px';
        videoElement.style.height = initialHeight + 'px';
        
        // Prevent any future height changes by watching for viewport resize
        let resizeTimer = null;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            // Only maintain height if keyboard isn't changing the viewport dramatically
            if (window.innerHeight < initialHeight) {
              // Keyboard is open, maintain locked height
              videoBackground.style.height = initialHeight + 'px';
              videoElement.style.height = initialHeight + 'px';
            }
          }, 100);
        });
      }
      
      // Run when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', lockVideoHeight);
      } else {
        lockVideoHeight();
      }
    })();
    
    // Encrypted wedding content (generated by build.js)
    const ENCRYPTED_DATA = '{"salt":"017470f5926f602d09bf55de71d91185","iv":"90143be50bc4c2930d7667397c643fc2","authTag":"7b277019b877f7751dbdb8dc27b8329b","content":"91d6cc6f859d81ae530e37be2d65e0212f75ec41a5ed08cb727167aa4d6c9637cb9d403d82c92ff04a98d30a01c3d37af503906f2a5c6863e12d65ee15bd6830876451d8b734eb55cba30e3bef5eb36b5cd86b4b1b77a5a695b9cc525fd45b423ee5fb85226f817ead4ab754c82feed862c9ebf87cf4f60383ff01cdb1ee7a273ea3448b915e371ba074aedef8f512db685394da6c6d4264d24c1d1a0ef74aef352b1619168e1abfd11c3810058725d29be9005b469c3918f7d56ef55be40dd4f75bdc7c072b827afc1d88e0051baf0816e762e2cc12a426d144f4b3654d8c745de76dba58ab2e851c40257a51d7063173b72365cfd1216baaf8be2c8c3427a020d3d5f3f90d309025549da682dc180f0274b2587523e0188a147918d8debd6fe8e01003fb7f10dfc46af91a39da6e85bc24492d53f2b06f500d1711b2e0b407d022e1137153312731941116953f2822b03ea2b5d574b35a83d3b5009e176ad67f12e1bef7abf2ea02c7816fe93848ed6bd0f1cc05446bf8b088e089e1c4b41d3a6cc167ed8f52ddabce49a9aa169efe39e3492ee7d45d36bd76dea0dc60970b0dae96aae748af6592e0a1fe71e3d88cf09cc94aefdb2291ea51287c1b6d45db3d2b47989cbc00be76a2fa005e869e8c21a2bbd7a45681561ba704b18848e63859d0fe0123f0c94562980b3457e95da64cd245c10fd91ff8cd86800cb269f86b514ad94debd1c526e30722eebe67b1ef77b2a0843ebdc914ea9e914fba172600b6ae201cfaa2ad719414f408519d59db2cff8357a62a2d94bacc12c1d040637e1dea784d8211cc5cdfb956edd255b64c7c94c65b842389c06d3a4f04357b54c1847ffb766589b346859b50f16c7381d0255a230f4f4b2c3c6cb2ae10acb57c221c67a21400f2f278cc4503a5c9c671b92c28f72d9e330306c87bd3cc1fc199ad57c769a567f9c49ed123159178310ad3259199e69d8512c69e5327ff3953145b071361189391caa38bb846cdd86dc630e28663f9f960dec6e8c1cda6ae700010445f8dcc253cdce4bf80ef4f4586523d3192d56f89bae754627e269d288e83330967b6d03056bf471bdfb5964676b8d8fb7146e536aa71964d0a0be80d26c754f8c813ca4d15d9d75257e71bccdcd6e06570d3f6dad2ca41aaf48c72f7a065bbfd92c0dbc3f44c8aae4155e8ecbe7fdeeae0931446bd22eec6600ca918990e9ab6dbd7bb4c1ccec34b306f7798be95fd3f67e4327881e9a1b88385ee69f2f4d87ef40f6cc755f48efe6095029760154426c96edb4664e08c38d2a588e488466aec1b9cb33b75c86e9643ecd6d6f370ee0f0faa4576ea5e4fc9d2a5083388111683b73d7702e6fe3b07430e01f8ff13453501b5e2f850141a5ac13b948b9bad8cb07e99f1d5234bc0f09ceb9db6696aa2274ad027c7f525832711942a820a19e5848a2952b1cdf702fef537f310603d1a116c417d68843fdcec59460adcf3ddd0acd466cb20a72810c2d9af2bca25dbcc35095cbf9c9c15b0d7f8485dc8952fd2c3869955484426c01d9e58eef4baabdffbb94e6d998a9edb0e728ec7c7446fd7386fab89a27b47dbf8f580d99df807814ee8809dfa8925e18f54ef61000fe46269dbd1242c4c2ec2c0a028a9418a10551f195da3b226711e2a520b1c45721ae4c225e65c0a5454969290f70c132d8d6b08cdf01bf584410bfe7268606b2b75cc96b405841fcbc03d3dfed1feca490948e2fa139db23d4f55da7fb3a3b71e5255c143f4e8ccad5fa5db9dd107c2ed0e884d3c4ad02ba96ed24dd58d3dc79d06f45a15238c51e5f13dbf00019bfda5713d058a47bf252bbe7eafbf2717ad8b3c95a2836315e37c12a6ff0029a0b4aeeee731f26a3a34b995520686899c0066b71be2a91525a3a40add2dd16adbf06806fee7fd498704844f6d20c8c099ba0d0f83393ad2be4d7aaba1690269352a79254af53daf666c238a3b0c4afc986d7aaa2dabe83ceb6a6c35be97757d8d49736035cb930c3ee961e64d3e54494a025cc1244f337bcf36bc6930d62fe33c2142d945227a4afe0f8bbec7a8ec1f265bdd7725d26dbd254ce286a15e22f4c297c2aabe1370ec43d1c3b1feab414dfdb36cbdba28ff287ddd6871df2d04089f231560d9d242512a3ff581584501c2e598aa45a178c26afb429959b85c8bfad300adc39f37aa3a971b8f3a79eaa24d838e647ebbc14259227eb1d6d7c0c78d3e"}';
    
    // Decrypt function using Web Crypto API
    async function decryptContent(password, encryptedPayload) {
      try {
        const { salt, iv, authTag, content } = JSON.parse(encryptedPayload);
        
        // Convert hex strings back to bytes
        const saltBytes = hexToBytes(salt);
        const ivBytes = hexToBytes(iv);
        const authTagBytes = hexToBytes(authTag);
        const contentBytes = hexToBytes(content);
        
        // Derive key from password using PBKDF2
        const enc = new TextEncoder();
        const passwordKey = await crypto.subtle.importKey(
          'raw',
          enc.encode(password),
          'PBKDF2',
          false,
          ['deriveBits']
        );
        
        const derivedBits = await crypto.subtle.deriveBits(
          {
            name: 'PBKDF2',
            salt: saltBytes,
            iterations: 100000,
            hash: 'SHA-256'
          },
          passwordKey,
          256
        );
        
        const key = await crypto.subtle.importKey(
          'raw',
          derivedBits,
          'AES-GCM',
          false,
          ['decrypt']
        );
        
        // Combine content and auth tag for GCM
        const combined = new Uint8Array(contentBytes.length + authTagBytes.length);
        combined.set(contentBytes);
        combined.set(authTagBytes, contentBytes.length);
        
        // Decrypt
        const decrypted = await crypto.subtle.decrypt(
          {
            name: 'AES-GCM',
            iv: ivBytes,
            tagLength: 128
          },
          key,
          combined
        );
        
        const dec = new TextDecoder();
        return dec.decode(decrypted);
      } catch (error) {
        return null;
      }
    }
    
    function hexToBytes(hex) {
      const bytes = new Uint8Array(hex.length / 2);
      for (let i = 0; i < hex.length; i += 2) {
        bytes[i / 2] = parseInt(hex.substr(i, 2), 16);
      }
      return bytes;
    }
    
    // Debounce timer for auto-checking password as user types
    let passwordCheckTimer = null;
    
    async function checkPasswordAsYouType() {
      const errorMsg = document.getElementById('errorMessage');
      errorMsg.textContent = ''; // Clear error message while typing
      
      // Clear previous timer
      if (passwordCheckTimer) {
        clearTimeout(passwordCheckTimer);
      }
      
      // Wait 300ms after user stops typing before checking
      passwordCheckTimer = setTimeout(async () => {
        await checkPassword();
      }, 300);
    }
    
    async function checkPassword() {
      const passwordInput = document.getElementById('passwordInput');
      const password = passwordInput.value;
      const errorMsg = document.getElementById('errorMessage');
      
      // Don't check if input is disabled (already granted access)
      if (passwordInput.disabled) {
        return;
      }
      
      if (!password) {
        return;
      }
      
      const decryptedContent = await decryptContent(password, ENCRYPTED_DATA);
      
      if (decryptedContent) {
        // Success! Show "Access Granted" in green
        const passwordInput = document.getElementById('passwordInput');
        passwordInput.type = 'text';
        passwordInput.value = 'Access Granted';
        passwordInput.classList.add('granted');
        passwordInput.disabled = true;
        
        // Parse and display content after half second delay
        setTimeout(async () => {
          try {
            const data = JSON.parse(decryptedContent);
            displayContent(data);
            
            // Hide password page
            document.getElementById('passwordPage').classList.add('hidden');
            
            // Trigger fade transitions for background
            document.body.classList.add('content-visible');
            document.querySelector('.container').classList.add('content-showing');
            
            // Show main content (but keep it transparent first)
            const mainContent = document.getElementById('mainContent');
            mainContent.style.display = 'flex';
            mainContent.style.opacity = '0';
            
            // Force reflow to ensure initial state is applied
            void mainContent.offsetWidth;
            
            // Now fade in the content
            setTimeout(() => {
              mainContent.style.opacity = '1';
            }, 10);
            
            // Store success in session (not password)
            sessionStorage.setItem('authenticated', 'true');
          } catch (error) {
            errorMsg.textContent = 'Error loading content';
          }
        }, 500);
      } else {
        // Only show error if password seems substantial (likely complete)
        // But don't show error if input is already disabled (access granted)
        if (password.length >= 8 && !passwordInput.disabled) {
          errorMsg.textContent = 'Incorrect password';
          // Clear after showing error briefly
          setTimeout(() => {
            document.getElementById('passwordInput').value = '';
            errorMsg.textContent = '';
            document.getElementById('passwordInput').focus();
          }, 1500);
        }
      }
    }
    
    function displayContent(data) {
      const content = document.getElementById('mainContent');
      
      // Simple centered message split into two lines
      content.innerHTML = '<h1>Meghan and Nolan<br>are the hottest.</h1>';
    }
    
    // Handle mobile keyboard - adjust positioning when focused
    function handleInputFocus() {
      // Check if we're on mobile
      const isMobile = window.innerWidth <= 600;
      if (!isMobile) return;
      
      const input = document.getElementById('passwordInput');
      const passwordPage = document.getElementById('passwordPage');
      const body = document.body;
      let resizeTimer = null; // Debounce resize events
      
      // Lock scroll position to prevent automatic scrolling (handles autocomplete bar too)
      let scrollLocked = false;
      let lockedScrollY = 0;
      let scrollLockInterval = null;
      
      // Aggressive scroll prevention function
      const preventScroll = function(e) {
        if (scrollLocked) {
          e.preventDefault();
          window.scrollTo(0, lockedScrollY);
          return false;
        }
      };
      
      // Continuously enforce scroll lock while keyboard is active
      const enforceScrollLock = function() {
        if (scrollLocked) {
          const currentScroll = window.pageYOffset || window.scrollY;
          if (Math.abs(currentScroll - lockedScrollY) > 1) {
            window.scrollTo(0, lockedScrollY);
          }
        }
      };
      
      input.addEventListener('focus', function() {
        // Lock current scroll position immediately
        lockedScrollY = window.pageYOffset || window.scrollY;
        scrollLocked = true;
        
        // Add multiple scroll prevention methods
        window.addEventListener('scroll', preventScroll, { passive: false, capture: true });
        window.addEventListener('touchmove', preventScroll, { passive: false, capture: true });
        
        // Continuously enforce scroll lock (handles autocomplete bar appearing)
        scrollLockInterval = setInterval(enforceScrollLock, 50);
      }, { once: true });
      
      // Use Visual Viewport API if available (modern mobile browsers)
      if (window.visualViewport) {
        // Adjust body padding when keyboard opens (handles both keyboard and autocomplete bar)
        const adjustForKeyboard = () => {
          // Clear previous timer
          if (resizeTimer) {
            clearTimeout(resizeTimer);
          }
          
          // Debounce resize events to prevent janky scrolling
          resizeTimer = setTimeout(() => {
            const viewport = window.visualViewport;
            const keyboardHeight = window.innerHeight - viewport.height;
            
            if (keyboardHeight > 150) { // Keyboard is open (or autocomplete bar appeared)
              // Position input closer to keyboard (lower on screen)
              // Just adjust padding, don't scroll
              body.style.paddingTop = '25vh';
              
              // Re-lock scroll position (autocomplete bar might have caused scroll)
              if (scrollLocked) {
                // Update locked position to current position to prevent jumping
                const currentScroll = window.pageYOffset || window.scrollY;
                lockedScrollY = currentScroll;
                window.scrollTo(0, lockedScrollY);
              }
            } else {
              // Reset to original positioning when keyboard closes
              body.style.paddingTop = '';
              // Unlock scroll
              scrollLocked = false;
              if (scrollLockInterval) {
                clearInterval(scrollLockInterval);
                scrollLockInterval = null;
              }
              window.removeEventListener('scroll', preventScroll, { capture: true });
              window.removeEventListener('touchmove', preventScroll, { capture: true });
            }
          }, 100); // Shorter debounce to catch autocomplete bar faster
        };
        
        // Don't call immediately - wait for keyboard to start opening
        window.visualViewport.addEventListener('resize', adjustForKeyboard);
        
        // Clean up listener when input loses focus
        input.addEventListener('blur', () => {
          window.visualViewport.removeEventListener('resize', adjustForKeyboard);
          if (resizeTimer) {
            clearTimeout(resizeTimer);
          }
          body.style.paddingTop = ''; // Reset to original CSS value
          // Unlock scroll
          scrollLocked = false;
          if (scrollLockInterval) {
            clearInterval(scrollLockInterval);
            scrollLockInterval = null;
          }
          window.removeEventListener('scroll', preventScroll, { capture: true });
          window.removeEventListener('touchmove', preventScroll, { capture: true });
        }, { once: true });
      }
    }
    
    // Check if already authenticated in this session
    if (sessionStorage.getItem('authenticated') === 'true') {
      document.getElementById('passwordInput').focus();
      // Could auto-prompt for password here if desired
    } else {
      document.getElementById('passwordInput').focus();
    }
  </script>
</body>
</html>

