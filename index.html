<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Meghan & Nolan</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸª©</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Raleway:wght@300;400;500;600&family=Sacramento&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Georgia', serif;
      background: #000;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
      padding-top: calc(58vh - 50px);
      position: relative;
      overflow: hidden;
    }
    
    
    /* Video background for password page */
    .video-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: -1;
      overflow: hidden;
      opacity: 1;
      transition: opacity 2s ease-out;
    }
    
    .video-background video {
      width: 100%;
      height: 100vh;
      object-fit: cover;
      object-position: center;
    }
    
    /* Mobile: video scrolls with content */
    @media (max-width: 768px) {
      .video-background {
        position: absolute;
      }
    }
    
    /* Dark overlay removed for brighter video */
    .video-background::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0);
      pointer-events: none;
    }
    
    /* Fallback gradient if video doesn't load */
    body.no-video {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    /* Fade out video on main content page */
    body.content-visible .video-background {
      opacity: 0;
      transition: opacity 2s ease-out;
      pointer-events: none;
    }
    
    html.content-visible,
    body.content-visible {
      height: auto !important;
      min-height: 100vh !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
    }
    
    body.content-visible {
      display: block !important;
      background: #faf9f7;
      align-items: flex-start;
      padding-top: 0 !important;
      padding: 0 !important;
      padding-bottom: 0 !important;
    }
    
    .container {
      background: transparent;
      border-radius: 0;
      max-width: 100%;
      width: 100%;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }
    
    /* No background or box for main content */
    .container.content-showing {
      background: transparent;
      box-shadow: none;
      height: 100vh;
      max-width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .password-page {
      padding: 60px 40px;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    
    .password-page h1 {
      color: #fff;
      margin-bottom: 20px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .password-page p {
      color: #fff;
      margin-bottom: 30px;
      font-size: 1.1em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    .password-input {
      width: 100%;
      max-width: 300px;
      padding: 15px 20px;
      font-size: 16px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      border: 1px solid rgba(68, 68, 68, 0.6);
      border-radius: 10px;
      transition: border-color 0.3s, color 0.3s;
      margin: 0;
      height: 50px;
      background: transparent;
      color: #fff;
      text-align: center;
    }
    
    .password-input::placeholder {
      color: rgba(200, 200, 200, 0.9);
      font-style: italic;
      text-align: center;
    }
    
    .password-input:focus {
      outline: none;
      border-color: rgba(68, 68, 68, 0.8);
    }
    
    .password-input-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      position: relative;
    }
    
    /* Ensure input stays visible on mobile when keyboard opens */
    .password-input.granted {
      color: #4ade80;
      border-color: #4ade80;
    }
    
    .btn {
      background: rgba(68, 68, 68, 0.7);
      color: white;
      border: none;
      padding: 0;
      font-size: 24px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
      font-weight: bold;
      width: 50px;
      height: 50px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      line-height: 1;
      backdrop-filter: blur(10px);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(68, 68, 68, 0.4);
      background: rgba(68, 68, 68, 0.85);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .error-message {
      color: #ff6b6b;
      margin-top: 15px;
      font-size: 14px;
      min-height: 20px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      font-weight: 500;
    }
    
    /* ========== MAIN CONTENT STYLES ========== */
    .main-content {
      display: none;
      width: 100%;
      min-height: 100vh;
      background: #faf9f7;
      opacity: 0;
      transition: opacity 2s ease-in;
      font-family: 'Raleway', sans-serif;
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    /* Site Header */
    .site-header {
      text-align: center;
      padding: 40px 20px 20px;
      background: #faf9f7;
    }
    
    .site-title {
      font-family: 'Bodoni Moda', serif;
      font-size: 4em;
      font-weight: 400;
      color: #1a1a1a;
      letter-spacing: 2px;
      margin-bottom: 15px;
    }
    
    .site-title .ampersand {
      font-style: normal;
    }
    
    .site-date {
      font-family: 'Raleway', sans-serif;
      font-size: 1.1em;
      font-weight: 400;
      color: #333;
      letter-spacing: 3px;
      text-transform: uppercase;
    }
    
    .site-date-mobile {
      display: none;
    }
    
    @media (max-width: 768px) {
      .site-date {
        display: none;
      }
      
      .site-date-mobile {
        display: block;
        font-family: 'Raleway', sans-serif;
        font-size: 1em;
        font-weight: 400;
        color: #333;
        letter-spacing: 2px;
        text-transform: uppercase;
        text-align: center;
      }
      
      .site-date-mobile .date-line,
      .site-date-mobile .location-line {
        display: block;
      }
      
      .site-date-mobile .date-divider {
        display: block;
        width: 40px;
        height: 2px;
        background: #F5A623;
        margin: 12px auto;
      }
    }
    
    /* Hide mobile elements on desktop */
    .mobile-top-bar,
    .mobile-menu,
    .mobile-scroll-container {
      display: none;
    }
    
    /* Desktop Navigation */
    .site-nav {
      display: flex;
      justify-content: center;
      gap: 40px;
      padding: 20px;
      background: #faf9f7;
    }
    
    .site-nav a {
      font-family: 'Raleway', sans-serif;
      font-size: 0.95em;
      font-weight: 400;
      color: #333;
      text-decoration: none;
      letter-spacing: 1px;
      padding: 5px 0;
      border-bottom: 1px solid transparent;
      transition: border-color 0.3s;
    }
    
    .site-nav a:hover,
    .site-nav a.active {
      border-bottom: 2px solid #F5A623;
    }
    
    /* Mobile top bar */
    .mobile-top-bar {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: #faf9f7;
      z-index: 1001;
      border-bottom: 1px solid #eee;
    }
    
    /* Mobile countdown bar */
    .mobile-countdown {
      display: none;
      width: 100%;
      padding: 5px 20px;
      background: #faf9f7;
      border-bottom: 1px solid #eee;
      align-items: center;
      justify-content: space-around;
      font-family: 'Raleway', sans-serif;
      font-size: 0.9em;
      color: #333;
    }
    
    .countdown-label-left {
      font-family: 'Bodoni Moda', serif;
      font-size: 1.5em;
      font-weight: 400;
      letter-spacing: 1px;
      color: #333;
    }
    
    .countdown-timer {
      display: flex;
      gap: 12px;
    }
    
    .countdown-unit {
      text-align: center;
    }
    
    .countdown-number {
      font-family: 'Bodoni Moda', serif;
      font-size: 1.4em;
      font-weight: 600;
      color: #F5A623;
      display: block;
      font-variant-numeric: tabular-nums;
    }
    
    .countdown-label {
      font-size: 0.75em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #666;
    }
    
    /* Mobile hero photo */
    .mobile-hero-photo {
      display: none;
      width: 100%;
      overflow: hidden;
    }
    
    .mobile-hero-photo img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    .mobile-top-bar-title {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Sacramento', cursive;
      font-size: 2em;
      font-weight: 400;
      letter-spacing: 1px;
      color: #333;
    }
    
    /* Desktop scroll container - full page scrollable */
    .desktop-scroll-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      overflow-x: hidden;
      background: #faf9f7;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE/Edge */
    }
    
    .desktop-scroll-container::-webkit-scrollbar {
      display: none; /* Chrome/Safari/Opera */
    }
    
    /* Mobile scroll container */
    .mobile-scroll-container {
      display: none;
      background: #faf9f7;
    }
    
    /* Mobile hamburger button */
    .hamburger {
      display: none;
      position: absolute;
      top: 50%;
      left: 15px;
      transform: translateY(-50%);
      z-index: 1002;
      background: none;
      border: none;
      cursor: pointer;
      padding: 10px;
    }
    
    .hamburger span {
      display: block;
      width: 25px;
      height: 2px;
      background: #333;
      margin: 5px 0;
      transition: all 0.3s;
    }
    
    .hamburger.active span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    
    .hamburger.active span:nth-child(2) {
      opacity: 0;
    }
    
    .hamburger.active span:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }
    
    /* Mobile menu overlay */
    .mobile-menu {
      display: none;
      position: fixed;
      top: 60px;
      left: 0;
      width: 100%;
      height: calc(100% - 60px);
      background: #faf9f7;
      z-index: 1000;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }
    
    .mobile-menu.active {
      opacity: 1;
      visibility: visible;
    }
    
    .mobile-menu-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .mobile-menu-title {
      font-family: 'Raleway', sans-serif;
      font-size: 0.9em;
      font-weight: 500;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: #333;
      margin-bottom: 30px;
    }
    
    .mobile-menu-couple {
      font-family: 'Bodoni Moda', serif;
      font-size: 2.5em;
      font-weight: 400;
      color: #1a1a1a;
      line-height: 1.3;
    }
    
    .mobile-menu-couple .ampersand {
      font-style: normal;
    }
    
    .mobile-menu-date {
      font-family: 'Raleway', sans-serif;
      font-size: 0.85em;
      font-weight: 400;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #333;
      margin-top: 15px;
    }
    
    .mobile-menu nav {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 25px;
    }
    
    .mobile-menu nav a {
      font-family: 'Raleway', sans-serif;
      font-size: 1.1em;
      font-weight: 400;
      color: #333;
      text-decoration: none;
      letter-spacing: 1px;
    }
    
    /* Page sections */
    .page-section {
      display: none;
      padding: 60px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .page-section.active {
      display: block;
    }
    
    .page-section h2 {
      font-family: 'Bodoni Moda', serif;
      font-size: 2.5em;
      font-weight: 400;
      color: #1a1a1a;
      text-align: center;
      margin-bottom: 40px;
    }
    
    .page-section p {
      font-family: 'Raleway', sans-serif;
      font-size: 1.1em;
      line-height: 1.8;
      color: #444;
      max-width: 800px;
      margin: 0 auto 20px;
    }
    
    /* Photo grid */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 40px;
    }
    
    .photo-grid img {
      width: 100%;
      height: 300px;
      object-fit: cover;
    }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
      .site-nav {
        display: none;
      }
      
      .mobile-top-bar {
        display: block;
      }
      
      /* Mobile countdown shows on mobile */
      .mobile-countdown {
        display: flex;
      }
      
      /* Mobile hero photo shows on mobile */
      .mobile-hero-photo {
        display: block;
      }
      
      .hamburger {
        display: block;
      }
      
      .mobile-menu {
        display: flex;
      }
      
      .site-title {
        font-size: 3em;
      }
      
      .site-header {
        padding: 15px 20px 30px; /* Reduced top padding since scroll container handles offset */
      }
      
      .photo-grid {
        grid-template-columns: 1fr;
      }
      
      .photo-grid img {
        height: 250px;
      }
      
      .page-section h2 {
        font-size: 1.8em;
      }
      
      /* Hide desktop scroll container on mobile */
      .desktop-scroll-container {
        display: none;
      }
      
      /* Mobile: scroll container is fixed below top bar */
      .mobile-scroll-container {
        display: block;
        position: fixed;
        top: 60px;
        left: 0;
        right: 0;
        bottom: 0;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE/Edge */
      }
      
      .mobile-scroll-container::-webkit-scrollbar {
        display: none; /* Chrome/Safari/Opera */
      }
      
      /* Mobile: add padding to header inside scroll container */
      .mobile-scroll-container .site-header {
        padding-top: 30px;
      }
    }
    
    .section {
      margin-bottom: 40px;
    }
    
    .section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.8em;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
    }
    
    .section p, .section li {
      color: #555;
      line-height: 1.8;
      font-size: 1.05em;
    }
    
    .venue-info {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    
    .schedule-item {
      background: #f9f9f9;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .schedule-item .time {
      font-weight: bold;
      color: #667eea;
      min-width: 100px;
    }
    
    .schedule-item .event {
      flex: 1;
      font-weight: bold;
      color: #333;
    }
    
    .schedule-item .location {
      color: #888;
      font-style: italic;
    }
    
    .accommodation-item, .registry-item {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    
    .accommodation-item h3, .registry-item h3 {
      color: #333;
      margin-bottom: 10px;
    }
    
    .accommodation-item a, .registry-item a {
      color: #667eea;
      text-decoration: none;
      font-weight: bold;
    }
    
    .accommodation-item a:hover, .registry-item a:hover {
      text-decoration: underline;
    }
    
    .code {
      background: #faf9f7;
      padding: 5px 10px;
      border-radius: 5px;
      font-family: monospace;
      color: #e74c3c;
      font-weight: bold;
    }
    
    @media (max-width: 600px) {
      .password-page, .main-content {
        padding: 40px 20px;
      }
      
      .header h1 {
        font-size: 2em;
      }
      
      .schedule-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .schedule-item .time {
        margin-bottom: 5px;
      }
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Video Background (only visible on password page) -->
  <div class="video-background">
    <video autoplay muted loop playsinline preload="auto">
      <source src="disco-ball.mp4" type="video/mp4">
    </video>
  </div>
  
  <!-- Password Page -->
  <div class="container">
    <div id="passwordPage" class="password-page">
      <div class="password-input-container">
        <input 
          type="text" 
          id="passwordInput" 
          class="password-input"
          placeholder="Enter password (v80)"
          oninput="checkPasswordAsYouType()"
          onkeydown="if(event.key === 'Enter') { event.preventDefault(); event.stopPropagation(); return false; }"
        />
      </div>
      <div id="errorMessage" class="error-message"></div>
    </div>
    
    <!-- Main Content (hidden until password correct) -->
    <div id="mainContent" class="main-content">
      <!-- Content will be dynamically loaded here after decryption -->
    </div>
  </div>

  <script>
    // Mobile: Lock video height to prevent resize when keyboard opens
    (function() {
      const isMobile = window.innerWidth <= 768;
      if (isMobile) {
        const initialHeight = window.innerHeight;
        const video = document.querySelector('.video-background');
        const videoEl = document.querySelector('.video-background video');
        
        // Lock video to initial height
        if (video) video.style.height = initialHeight + 'px';
        if (videoEl) videoEl.style.height = initialHeight + 'px';
      }
    })();
    
    // Encrypted wedding content (generated by build.js)
    const ENCRYPTED_DATA = '{"salt":"6fbc34e84a16226d0c94e008025803a5","iv":"82b3a9a6f66909b1bc9987987f45be47","authTag":"1cb5f0a92dfcaae4b896cba6dbe78977","content":"b07c0098719f28e8167a0d6ae904b52b982e54035f7937e44de0d38803c164168f01a5856207d608b6c1a4cc0dc0d250b4618cdb662c08173c175ec4299586c7a1dbb663ccca73eb74cccfbc0dc330c8cf6068526fd25e6c5b928caa93cafac01f671dac98531060271ecf7bf923fb510443215dd10698eb4e6ecb4b3029c0911ac4f3a974fc49b0124979874615a4d5b8dcb8f07fde333418d16061c55b2e5ade0a6f98413b438b147fcfdf2f57a39ca4880dccd196a327fc8de41b4ba606b517fef3d768124bd009f36d18062f43de982ac7fb3e043af79f43b67c50b8d3016f31524fae4a04ad2c699daa0825e103780507af196538bf04df63ff206b208205331155e8c4e5f62c1aa471deb1e4ba69ac705c1842e5fb071fc559ef14761a8652d2ca2c64a6a3ee5031f95647d11b55bd4c31a1e0fa1466a5d18b17c181ca7ae6e36f317bc0783b38d5910ebb53fcee981dec8502f790c4d81717c7f8a53cf8ffcb53e023d3de6b8a1e5f04fbd7e18844b051dc4aa060e6bf31a4a03d2cb1f1bdcaeb186809edadbf20c7902caa47a172f1d78c12bdb4c9c951c2bf7b1c47b03655f21598f4fa2c3fc55c8454a975b40887b34a10240e58e5489efc072977bdcf98e9c56024c13dd602fe09d72c0413bfe8b1cae9bb88da15dc80a7f2ddfb47d0eda6c2f1c58000c2ab397dfda7aa9ede993fd630ec9c28a60139011df22be06cb66dba94ca5d733659e11b37989432b3fa319fe06c600d4e8358b0fd02e4d40c76815c3fd9b523c1c03ad365451b2e02cddcee4b6a0fc6f68cfc25992d0ce89781ede88eb4d90b78bac71686e689bf78741ee8c4c4db7d01f549782e4b58a825c9647907fb38e5c176a4f7fc72f1c0c3915d8e8099ac9e94e657ac60bcaedc8bb28e7b279b845ce312a163979b9c04bbe8488ba1eb5e0bc7435b19259fe74fb6d4358cbf4502c9a2e517d28be92bb4bd88c76df4fa9d4e275441a989c806647e5c0448bba9d5e21353fe8c5bb9819029684fede891511a0a7578feb20a4739316468189c33a3b68beb72fedfc15157341dd3bebe5e8514ce8d554ac0d8d63a0666bc383375b2259b3069adf990074adab4b691526a59143de740df46df886ce73f6c838c4b3e947a46a6516b338895fbdf84ee6cac1d09a8047d37ed2f8e8b78cd45d220c31198e74c0032850d47bb8879c6496a57b2361d6ccdd6f35d7b73b714d9aec67e6eaf30a10fb7cc9719d2733c7935d3d85f1a5d19fde3637d0682043e396c4fd67a594d3991325b19520585fc67d23e67a45fe63dec59684a98ea2698c807a544f1a04fed25529504c707ae0e591acafa9f727dbabf9e1d5574641987ab83904885ae118d24acde2f9c70c4260c396897f65685936378e2df2c8b655ec9c307b2cba9c0386d6ad86a4840d5d295f6fcf70a1561f23eb17c435191659e8d583e05f72ecea4d8edbe080534b63e29b11a54457ec0c3dab9fac1798eb338750260ede6e2b32938a0f90447dfd8c5bcb16a68d84d6cb044c159196aeac1f35efb5b2cbb9a1ec2000efba2fed80ee00155955cf5c1195ca6567071fedc4b1bc44207f519d911339014d94724eb996900a330325ae859bad2433af6492d6cdfd37bc1cc436db2dc89b23eb68a6e2c4d6b20865ab761dcc88eb6894b88bbae83f76ac52c1b029c8991cd8b8161aaae197583495c040e598ecd958fdeb2afcf105d0944132cddd2fc7774847efd454424d1b7820f3435ab24e449ef967a63e16d721abbc83c9127dce8c6b796928986b17c223f86f34f42ea3a8f7d0d1852d567413717fb97926cd2b5a2f53d5c7709b50b77357f931688087b92de81ba6b09a11f2f01de464f808c56ccf261bd8f051f3ea3be7426c40bda16930296fd5e5fdf7c2a58147332708bc56b2f99d668681d1069a17f2cee6c02a8af00b896c5fbd8c7a55b4d06faec38b3a23ad74c7fdd8379778c2f9bb88070ed1160b0dee76ccf6e0a7f0023be80aeb9c48389d0c8e39d3fe28fc5eeb459765dfb844466fb81cb01fde6e688b7479113a0ec8461d0766cfdef876eedd85173be42fa9655da02aa79840339cf7e0c9e7e7f85be1e7d8f0c433e1f9683b00d0fb03130dfaad1473588a28a857af1c515b903341f7b14d9c6f41b5638a34a0d851383a2dde351fe860425b06294badf0866e8b9b33d00ef5de19fd2fd5160e269bd5424323a5a0f1a00a3e2aee99866c6be"}';
    
    // Decrypt function using Web Crypto API
    async function decryptContent(password, encryptedPayload) {
      try {
        const { salt, iv, authTag, content } = JSON.parse(encryptedPayload);
        
        // Convert hex strings back to bytes
        const saltBytes = hexToBytes(salt);
        const ivBytes = hexToBytes(iv);
        const authTagBytes = hexToBytes(authTag);
        const contentBytes = hexToBytes(content);
        
        // Derive key from password using PBKDF2
        const enc = new TextEncoder();
        const passwordKey = await crypto.subtle.importKey(
          'raw',
          enc.encode(password),
          'PBKDF2',
          false,
          ['deriveBits']
        );
        
        const derivedBits = await crypto.subtle.deriveBits(
          {
            name: 'PBKDF2',
            salt: saltBytes,
            iterations: 100000,
            hash: 'SHA-256'
          },
          passwordKey,
          256
        );
        
        const key = await crypto.subtle.importKey(
          'raw',
          derivedBits,
          'AES-GCM',
          false,
          ['decrypt']
        );
        
        // Combine content and auth tag for GCM
        const combined = new Uint8Array(contentBytes.length + authTagBytes.length);
        combined.set(contentBytes);
        combined.set(authTagBytes, contentBytes.length);
        
        // Decrypt
        const decrypted = await crypto.subtle.decrypt(
          {
            name: 'AES-GCM',
            iv: ivBytes,
            tagLength: 128
          },
          key,
          combined
        );
        
        const dec = new TextDecoder();
        return dec.decode(decrypted);
      } catch (error) {
        return null;
      }
    }
    
    function hexToBytes(hex) {
      const bytes = new Uint8Array(hex.length / 2);
      for (let i = 0; i < hex.length; i += 2) {
        bytes[i / 2] = parseInt(hex.substr(i, 2), 16);
      }
      return bytes;
    }
    
    // Debounce timer for auto-checking password as user types
    let passwordCheckTimer = null;
    
    async function checkPasswordAsYouType() {
      const errorMsg = document.getElementById('errorMessage');
      errorMsg.textContent = ''; // Clear error message while typing
      
      // Clear previous timer
      if (passwordCheckTimer) {
        clearTimeout(passwordCheckTimer);
      }
      
      // Wait 300ms after user stops typing before checking
      passwordCheckTimer = setTimeout(async () => {
        await checkPassword();
      }, 300);
    }
    
    async function checkPassword() {
      const passwordInput = document.getElementById('passwordInput');
      const password = passwordInput.value;
      const errorMsg = document.getElementById('errorMessage');
      
      // Don't check if input is disabled (already granted access)
      if (passwordInput.disabled) {
        return;
      }
      
      if (!password) {
        return;
      }
      
      const decryptedContent = await decryptContent(password, ENCRYPTED_DATA);
      
      if (decryptedContent) {
        // Success! Show "Access Granted" in green
        const passwordInput = document.getElementById('passwordInput');
        passwordInput.type = 'text';
        passwordInput.value = 'Access Granted';
        passwordInput.classList.add('granted');
        passwordInput.disabled = true;
        
        // Close keyboard and scroll back to top first
        passwordInput.blur();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Wait for keyboard to close and scroll to complete, then fade
        setTimeout(async () => {
          try {
            const data = JSON.parse(decryptedContent);
            displayContent(data);
            
            // Load correct section based on current URL or redirect from 404
            let path = sessionStorage.getItem('redirect');
            if (path) {
              sessionStorage.removeItem('redirect');
            } else {
              path = window.location.pathname;
            }
            // Extract section ID from path (handle both /photos and /wedding/photos)
            const pathParts = path.split('/').filter(p => p);
            // Filter out 'wedding' base path if present
            const filteredParts = pathParts.filter(p => p !== 'wedding');
            const sectionId = filteredParts.length === 0 ? 'home' : filteredParts[filteredParts.length - 1];
            // Always show the appropriate section (including home)
            if (sectionId !== 'home') {
              showSectionFromUrl(sectionId);
            }
            // Home section is already active by default in the HTML
            
            // Hide password page
            document.getElementById('passwordPage').classList.add('hidden');
            
            // Reset mobile-specific styles before showing content
            document.body.style.minHeight = '';
            document.body.style.paddingBottom = '';
            document.body.style.paddingTop = '';
            document.body.style.overflow = '';
            window.scrollTo(0, 0);
            
            // Trigger fade transitions for background
            document.documentElement.classList.add('content-visible');
            document.body.classList.add('content-visible');
            document.querySelector('.container').classList.add('content-showing');
            
            // Show main content (but keep it transparent first)
            const mainContent = document.getElementById('mainContent');
            mainContent.style.display = 'block';
            mainContent.style.opacity = '0';
            
            // Force reflow to ensure initial state is applied
            void mainContent.offsetWidth;
            
            // Now fade in the content
            setTimeout(() => {
              mainContent.style.opacity = '1';
            }, 100);
            
            // Store success in session (not password)
            sessionStorage.setItem('authenticated', 'true');
          } catch (error) {
            console.error('Error loading content:', error);
            errorMsg.textContent = 'Error loading content: ' + error.message;
          }
        }, 800);
      } else {
        // Only show error if password seems substantial (likely complete)
        // But don't show error if input is already disabled (access granted)
        if (password.length >= 8 && !passwordInput.disabled) {
          errorMsg.textContent = 'Incorrect password';
          // Clear after showing error briefly
          setTimeout(() => {
            document.getElementById('passwordInput').value = '';
            errorMsg.textContent = '';
            document.getElementById('passwordInput').focus();
          }, 1500);
        }
      }
    }
    
    function displayContent(data) {
      const content = document.getElementById('mainContent');
      
      const sectionsHTML = `
        <!-- Home Section -->
        <section class="page-section active" id="section-home">
          <h2>Welcome</h2>
          <p>We are so excited to celebrate our wedding with you! Please explore this site for all the details about our special day.</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
          <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
          <p>Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet.</p>
          <p>At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident.</p>
        </section>
        
        <!-- Photos Section -->
        <section class="page-section" id="section-photos">
          <h2>Photos</h2>
          <p>A collection of our favorite moments together.</p>
          <div class="photo-grid">
            <!-- Photos will go here -->
          </div>
        </section>
        
        <!-- Q+A Section -->
        <section class="page-section" id="section-qa">
          <h2>Q + A</h2>
          <p>Answers to frequently asked questions about our wedding.</p>
        </section>
        
        <!-- Travel Section -->
        <section class="page-section" id="section-travel">
          <h2>Travel</h2>
          <p>Information about getting to Nantucket and where to stay.</p>
        </section>
        
        <!-- Things to Do Section -->
        <section class="page-section" id="section-things">
          <h2>Things to Do</h2>
          <p>Our favorite spots and activities on the island.</p>
        </section>
        
        <!-- RSVP Section -->
        <section class="page-section" id="section-rsvp">
          <h2>RSVP</h2>
          <p>Coming soon.</p>
        </section>
        
        <!-- Registry Section -->
        <section class="page-section" id="section-registry">
          <h2>Our Registry</h2>
          <p>Thank you for thinking of us!</p>
        </section>
      `;
      
      content.innerHTML = `
        <!-- DESKTOP: One big scrollable container -->
        <div class="desktop-scroll-container">
          <header class="site-header">
            <h1 class="site-title">MEGHAN <span class="ampersand">&</span> NOLAN</h1>
            <p class="site-date">December 31, 2026 <span style="color: #F5A623;">âœ¦</span> Boston, Massachusetts</p>
          </header>
          <nav class="site-nav">
            <a href="/" onclick="showSection('home'); return false;" class="active">Home</a>
            <a href="/photos" onclick="showSection('photos'); return false;">Photos</a>
            <a href="/qa" onclick="showSection('qa'); return false;">Q + A</a>
            <a href="/travel" onclick="showSection('travel'); return false;">Travel</a>
            <a href="/things" onclick="showSection('things'); return false;">Things to Do</a>
            <a href="/rsvp" onclick="showSection('rsvp'); return false;">RSVP</a>
            <a href="/registry" onclick="showSection('registry'); return false;">Our Registry</a>
          </nav>
          <div class="desktop-sections">
            ${sectionsHTML}
          </div>
        </div>
        
        <!-- MOBILE: Fixed top bar + scrollable content below -->
        <div class="mobile-top-bar">
          <button class="hamburger" onclick="toggleMobileMenu()">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <span class="mobile-top-bar-title" id="mobilePageTitle">M & N</span>
        </div>
        
        <div class="mobile-menu" id="mobileMenu">
          <nav>
            <a href="/" onclick="showSection('home'); return false;">Home</a>
            <a href="/photos" onclick="showSection('photos'); return false;">Photos</a>
            <a href="/qa" onclick="showSection('qa'); return false;">Q + A</a>
            <a href="/travel" onclick="showSection('travel'); return false;">Travel</a>
            <a href="/things" onclick="showSection('things'); return false;">Things to Do</a>
            <a href="/rsvp" onclick="showSection('rsvp'); return false;">RSVP</a>
            <a href="/registry" onclick="showSection('registry'); return false;">Our Registry</a>
          </nav>
        </div>
        
        <div class="mobile-scroll-container">
          <!-- MOBILE: Countdown timer (only on home page) -->
          <div class="mobile-countdown">
            <span class="countdown-label-left">NYE 2026:</span>
            <div class="countdown-timer">
              <div class="countdown-unit">
                <span class="countdown-number" id="days">000</span>
                <span class="countdown-label">Days</span>
              </div>
              <div class="countdown-unit">
                <span class="countdown-number" id="hours">00</span>
                <span class="countdown-label">Hours</span>
              </div>
              <div class="countdown-unit">
                <span class="countdown-number" id="minutes">00</span>
                <span class="countdown-label">Min</span>
              </div>
              <div class="countdown-unit">
                <span class="countdown-number" id="seconds">00</span>
                <span class="countdown-label">Sec</span>
              </div>
            </div>
          </div>
          <!-- MOBILE: Hero photo (only on home page) -->
          <div class="mobile-hero-photo">
            <img src="ducklings_in_the_snow.jpg" alt="Ducklings in the Snow">
          </div>
          <header class="site-header">
            <h1 class="site-title">MEGHAN <span class="ampersand">&</span> NOLAN</h1>
            <div class="site-date-mobile">
              <span class="date-line">December 31, 2026</span>
              <span class="date-divider"></span>
              <span class="location-line">Boston, Massachusetts</span>
            </div>
          </header>
          <div class="mobile-sections">
            ${sectionsHTML}
          </div>
        </div>
      `;
      
      // Start countdown timer
      startCountdown();
    }
    
    // Countdown timer to December 31, 2026 at midnight ET
    function startCountdown() {
      function updateCountdown() {
        // Target date: December 31, 2026, 00:00:00 ET (UTC-5)
        const targetDate = new Date('2026-12-31T00:00:00-05:00');
        const now = new Date();
        const diff = targetDate - now;
        
        if (diff <= 0) {
          // Event has passed
          document.getElementById('days').textContent = '000';
          document.getElementById('hours').textContent = '00';
          document.getElementById('minutes').textContent = '00';
          document.getElementById('seconds').textContent = '00';
          return;
        }
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        document.getElementById('days').textContent = String(days).padStart(3, '0');
        document.getElementById('hours').textContent = String(hours).padStart(2, '0');
        document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
        document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
      }
      
      // Update immediately and then every second
      updateCountdown();
      setInterval(updateCountdown, 1000);
    }
    
    // Get base path (e.g., '/wedding' for GitHub Pages or '' for root domain)
    function getBasePath() {
      const path = window.location.pathname;
      const parts = path.split('/').filter(p => p);
      // If first part is 'wedding' (repo name), use it as base
      if (parts.length > 0 && parts[0] === 'wedding') {
        return '/wedding';
      }
      return '';
    }
    
    function toggleMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      const hamburger = document.querySelector('.hamburger');
      menu.classList.toggle('active');
      hamburger.classList.toggle('active');
    }
    
    function showSection(sectionId) {
      // Section title mapping
      const titles = {
        'home': 'M & N',
        'photos': 'Photos',
        'qa': 'Q + A',
        'travel': 'Travel',
        'things': 'Things to Do',
        'rsvp': 'RSVP',
        'registry': 'Our Registry'
      };
      
      // Hide all sections
      document.querySelectorAll('.page-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Show selected section in both desktop and mobile containers
      document.querySelectorAll('#section-' + sectionId).forEach(section => {
        section.classList.add('active');
      });
      
      // Update nav active state
      document.querySelectorAll('.site-nav a').forEach(link => {
        link.classList.remove('active');
      });
      if (typeof event !== 'undefined' && event.target) {
        event.target.classList.add('active');
      }
      
      // Update mobile top bar title
      const mobileTitle = document.getElementById('mobilePageTitle');
      if (mobileTitle && titles[sectionId]) {
        mobileTitle.textContent = titles[sectionId];
      }
      
      // Show/hide countdown and hero photo on mobile (only on home page)
      const countdown = document.querySelector('.mobile-countdown');
      const heroPhoto = document.querySelector('.mobile-hero-photo');
      if (countdown) {
        countdown.style.display = sectionId === 'home' ? 'flex' : 'none';
      }
      if (heroPhoto) {
        heroPhoto.style.display = sectionId === 'home' ? 'block' : 'none';
      }
      
      // Update URL without page reload (preserve base path)
      const basePath = getBasePath();
      const path = sectionId === 'home' ? basePath + '/' : basePath + '/' + sectionId;
      window.history.pushState({ section: sectionId }, '', path);
      
      // Close mobile menu if open
      const menu = document.getElementById('mobileMenu');
      const hamburger = document.querySelector('.hamburger');
      if (menu) menu.classList.remove('active');
      if (hamburger) hamburger.classList.remove('active');
      
      return false;
    }
    
    // Handle browser back/forward buttons
    window.addEventListener('popstate', function(e) {
      if (e.state && e.state.section) {
        showSectionFromUrl(e.state.section);
      } else {
        // Default to home if no state
        showSectionFromUrl('home');
      }
    });
    
    // Helper function to show section without modifying history
    function showSectionFromUrl(sectionId) {
      const titles = {
        'home': 'M & N',
        'photos': 'Photos',
        'qa': 'Q + A',
        'travel': 'Travel',
        'things': 'Things to Do',
        'rsvp': 'RSVP',
        'registry': 'Our Registry'
      };
      
      document.querySelectorAll('.page-section').forEach(section => {
        section.classList.remove('active');
      });
      
      document.querySelectorAll('#section-' + sectionId).forEach(section => {
        section.classList.add('active');
      });
      
      document.querySelectorAll('.site-nav a, .mobile-menu a').forEach(link => {
        link.classList.remove('active');
      });
      
      const mobileTitle = document.getElementById('mobilePageTitle');
      if (mobileTitle && titles[sectionId]) {
        mobileTitle.textContent = titles[sectionId];
      }
      
      // Show/hide countdown and hero photo on mobile (only on home page)
      const countdown = document.querySelector('.mobile-countdown');
      const heroPhoto = document.querySelector('.mobile-hero-photo');
      if (countdown) {
        countdown.style.display = sectionId === 'home' ? 'flex' : 'none';
      }
      if (heroPhoto) {
        heroPhoto.style.display = sectionId === 'home' ? 'block' : 'none';
      }
    }
    
  </script>
</body>
</html>

